import{r as T,i as j,c as S,d as k,t as fe,g as Q,a as _e,b as ve,o as me,e as he,f as t,S as be,m as R,F as Pe,h as ye,j as re,G as H,k as V,_ as Se,l as I,n as M,p as B,q,s as O,u as f,v,w as $e,x as Ce,y as Ie,z as Le,A as we,B as xe,C as ze,D as ie,E as i,H as oe,T as Me,I as Be,J as ke,K as ce,L as je,M as Re,N as He,O as Oe,P as Ve,Q as Ne,R as Te}from"./index-BGGIvtcR.js";import{u as Ae,a as De,S as Ee,P as Fe,V as Ge,E as Ue}from"./index-EgcfBpA-.js";import{f as le,I as qe,a as Ke}from"./file-BtNazTMo.js";const Je=(e,{emit:o})=>{var a,g;const n=T(j(e.paginationProps)&&(a=e.paginationProps.defaultCurrent)!=null?a:1),u=T(j(e.paginationProps)&&(g=e.paginationProps.defaultPageSize)!=null?g:10),$=S(()=>{var s;return j(e.paginationProps)&&(s=e.paginationProps.current)!=null?s:n.value}),h=S(()=>{var s;return j(e.paginationProps)&&(s=e.paginationProps.pageSize)!=null?s:u.value});return{current:$,pageSize:h,handlePageChange:s=>{n.value=s,o("pageChange",s)},handlePageSizeChange:s=>{u.value=s,o("pageSizeChange",s)}}};function se(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!V(e)}var K=k({name:"List",props:{data:{type:Array},size:{type:String,default:"medium"},bordered:{type:Boolean,default:!0},split:{type:Boolean,default:!0},loading:{type:Boolean,default:!1},hoverable:{type:Boolean,default:!1},paginationProps:{type:Object},gridProps:{type:Object},maxHeight:{type:[String,Number],default:0},bottomOffset:{type:Number,default:0},virtualListProps:{type:Object},scrollbar:{type:[Object,Boolean],default:!0}},emits:{scroll:()=>!0,reachBottom:()=>!0,pageChange:e=>!0,pageSizeChange:e=>!0},setup(e,{emit:o,slots:a}){const{scrollbar:g}=fe(e),n=Q("list"),u=_e(ve,void 0),{componentRef:$,elementRef:h}=Ae("containerRef"),C=S(()=>e.virtualListProps),{displayScrollbar:L,scrollbarProps:s}=De(g);let m=0;const b=r=>{const{scrollTop:l,scrollHeight:d,offsetHeight:p}=r.target,c=Math.floor(d-(l+p));l>m&&c<=e.bottomOffset&&o("reachBottom"),o("scroll"),m=l};me(()=>{if(h.value){const{scrollTop:r,scrollHeight:l,offsetHeight:d}=h.value;l<=r+d&&o("reachBottom")}});const{current:x,pageSize:w,handlePageChange:P,handlePageSizeChange:A}=Je(e,{emit:o}),z=r=>{if(!e.paginationProps)return r;if(e.paginationProps&&r.length>w.value){const l=(x.value-1)*w.value;return r.slice(l,l+w.value)}return r},D=r=>{let l;if(!e.gridProps)return null;const d=z(r);if(e.gridProps.span){const p=[],c=24/e.gridProps.span;for(let y=0;y<d.length;y+=c){let G;const ge=y+c,ee=Math.floor(y/c);p.push(t(H.Row,{key:ee,class:`${n}-row`,gutter:e.gridProps.gutter},se(G=d.slice(y,ge).map((U,te)=>{var ae;return t(H.Col,{key:`${ee}-${te}`,class:`${n}-col`,span:(ae=e.gridProps)==null?void 0:ae.span},{default:()=>{var ne;return[V(U)?U:(ne=a.item)==null?void 0:ne.call(a,{item:U,index:te})]}})}))?G:{default:()=>[G]}))}return p}return t(H.Row,{class:`${n}-row`,gutter:e.gridProps.gutter},se(l=d.map((p,c)=>t(H.Col,R({key:c,class:`${n}-col`},re(e.gridProps,["gutter"])),{default:()=>{var y;return[V(p)?p:(y=a.item)==null?void 0:y.call(a,{item:p,index:c})]}})))?l:{default:()=>[l]})},E=r=>z(r).map((d,p)=>{var c;return V(d)?d:(c=a.item)==null?void 0:c.call(a,{item:d,index:p})}),F=()=>{const r=a.default?ye(a.default()):e.data;return r&&r.length>0?e.gridProps?D(r):E(r):Z()},_=()=>{if(!e.paginationProps)return null;const r=re(e.paginationProps,["current","pageSize","defaultCurrent","defaultPageSize"]);return t(Fe,R({class:`${n}-pagination`},r,{current:x.value,pageSize:w.value,onChange:P,onPageSizeChange:A}),null)},ue=S(()=>[n,`${n}-${e.size}`,{[`${n}-bordered`]:e.bordered,[`${n}-split`]:e.split,[`${n}-hover`]:e.hoverable}]),de=S(()=>{if(e.maxHeight)return{maxHeight:he(e.maxHeight)?`${e.maxHeight}px`:e.maxHeight,overflowY:"auto"}}),Y=S(()=>[`${n}-content`,{[`${n}-virtual`]:C.value}]),W=T(),pe=()=>{var r;const l=z((r=e.data)!=null?r:[]);return l.length?t(Ge,R({ref:W,class:Y.value,data:l},e.virtualListProps,{onScroll:b}),{item:({item:d,index:p})=>{var c;return(c=a.item)==null?void 0:c.call(a,{item:d,index:p})}}):Z()},X=()=>a["scroll-loading"]?t("div",{class:[`${n}-item`,`${n}-scroll-loading`]},[a["scroll-loading"]()]):null,Z=()=>{var r,l,d,p,c;return a["scroll-loading"]?null:(c=(p=(r=a.empty)==null?void 0:r.call(a))!=null?p:(d=u==null?void 0:(l=u.slots).empty)==null?void 0:d.call(l,{component:"list"}))!=null?c:t(Ue,null,null)};return{virtualListRef:W,render:()=>{const r=L.value?Ee:"div";return t("div",{class:`${n}-wrapper`},[t(be,{class:`${n}-spin`,loading:e.loading},{default:()=>[t(r,R({ref:$,class:ue.value,style:de.value},s.value,{onScroll:b}),{default:()=>[t("div",{class:`${n}-content-wrapper`},[a.header&&t("div",{class:`${n}-header`},[a.header()]),C.value&&!e.gridProps?t(Pe,null,[pe(),X()]):t("div",{role:"list",class:Y.value},[F(),X()]),a.footer&&t("div",{class:`${n}-footer`},[a.footer()])])]}),_()]})])}}},methods:{scrollIntoView(e){this.virtualListRef&&this.virtualListRef.scrollTo(e)}},render(){return this.render()}}),N=k({name:"ListItem",props:{actionLayout:{type:String,default:"horizontal"}},setup(e,{slots:o}){const a=Q("list-item"),g=()=>{var n;const u=(n=o.actions)==null?void 0:n.call(o);return!u||!u.length?null:t("ul",{class:`${a}-action`},[u.map(($,h)=>t("li",{key:`${a}-action-${h}`},[$]))])};return()=>{var n,u;return t("div",{role:"listitem",class:a},[t("div",{class:`${a}-main`},[(n=o.meta)==null?void 0:n.call(o),t("div",{class:`${a}-content`},[(u=o.default)==null?void 0:u.call(o)]),e.actionLayout==="vertical"&&g()]),e.actionLayout==="horizontal"&&g(),o.extra&&t("div",{class:`${a}-extra`},[o.extra()])])}}});const Qe=k({name:"ListItemMeta",props:{title:String,description:String},setup(e,{slots:o}){const a=Q("list-item-meta"),g=!!(e.title||e.description||o.title||o.description);return{prefixCls:a,hasContent:g}}});function Ye(e,o,a,g,n,u){return I(),M("div",{class:B(e.prefixCls)},[e.$slots.avatar?(I(),M("div",{key:0,class:B(`${e.prefixCls}-avatar`)},[q(e.$slots,"avatar")],2)):O("v-if",!0),e.hasContent?(I(),M("div",{key:1,class:B(`${e.prefixCls}-content`)},[e.$slots.title||e.title?(I(),M("div",{key:0,class:B(`${e.prefixCls}-title`)},[q(e.$slots,"title",{},()=>[f(v(e.title),1)])],2)):O("v-if",!0),e.$slots.description||e.description?(I(),M("div",{key:1,class:B(`${e.prefixCls}-description`)},[q(e.$slots,"description",{},()=>[f(v(e.description),1)])],2)):O("v-if",!0)],2)):O("v-if",!0)],2)}var J=Se(Qe,[["render",Ye]]);const We=Object.assign(K,{Item:Object.assign(N,{Meta:J}),install:(e,o)=>{$e(e,o);const a=Ce(o);e.component(a+K.name,K),e.component(a+N.name,N),e.component(a+J.name,J)}}),Xe=e=>(Oe("data-v-91e0c931"),e=e(),Ve(),e),Ze=Xe(()=>Ne("br",null,null,-1)),et=k({__name:"banList",setup(e){const o=T(),a=Ie(),g=Le(),{data:n,refresh:u}=we(xe,{pollingInterval:S(()=>a.pollingInterval),onSuccess:a.renewLastUpdate}),$=C=>{var L,s;if(C){const m=(L=n.value)==null?void 0:L.map(b=>b.address).findIndex(b=>b.includes(C));m!==-1&&((s=o.value)==null||s.scrollIntoView({index:m,align:"auto"}))}};ze(()=>g.endpoint,u,{immediate:!0});const h=S(()=>n.value??[]);return(C,L)=>{const s=Me,m=Be,b=ke,x=ce,w=je,P=Re,A=qe,z=Ke,D=He,E=N,F=We;return I(),ie(x,{direction:"vertical",fill:""},{default:i(()=>[t(s,{heading:3},{default:i(()=>[f("封禁名单")]),_:1}),Ze,t(x,{class:"list-header"},{default:i(()=>[t(m,null,{default:i(()=>[f("以下是封禁列表（按时间倒序排列）")]),_:1}),t(b,{style:{width:"250px"},placeholder:"搜索 IP 地址",onSearch:$,"allow-clear":"","search-button":""})]),_:1}),t(F,{virtualListProps:{height:500},ref_key:"banlist",ref:o,"max-height":"1000",data:h.value},{item:i(({item:_})=>[t(E,null,{default:i(()=>[t(D,{column:{xs:1,md:2,xl:3}},{title:i(()=>[t(w,null,{default:i(()=>[t(m,{bold:"",copyable:""},{default:i(()=>[f(v(_.banMetadata.peer.address.ip)+":"+v(_.banMetadata.peer.address.port),1)]),_:2},1024),f("   "),t(m,{code:""},{default:i(()=>[f(v(_.banMetadata.peer.clientName),1)]),_:2},1024)]),_:2},1024)]),default:i(()=>[t(P,{label:"反向 DNS 解析",span:1},{default:i(()=>[f(v(_.banMetadata.reverseLookup),1)]),_:2},1024),t(P,{label:"封禁时间",span:1},{default:i(()=>[f(v(new Date(_.banMetadata.banAt).toLocaleString("zh-cn")),1)]),_:2},1024),t(P,{label:"预计解封时间",span:1},{default:i(()=>[f(v(new Date(_.banMetadata.unbanAt).toLocaleString("zh-cn")),1)]),_:2},1024),t(P,{label:"发现位置",span:2},{default:i(()=>[f(v(_.banMetadata.torrent.name),1)]),_:2},1024),t(P,{label:"封禁快照",span:1},{default:i(()=>[t(A,{class:"green"}),f(" "+v(oe(le)(_.banMetadata.peer.uploaded))+" ",1),t(z,{class:"red"}),f(" "+v(oe(le)(_.banMetadata.peer.downloaded))+" - "+v((_.banMetadata.peer.progress*100).toFixed(2))+"% ",1)]),_:2},1024),t(P,{label:"封禁原因",span:3},{default:i(()=>[f(v(_.banMetadata.description),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1},8,["data"])]),_:1})}}}),tt=Te(et,[["__scopeId","data-v-91e0c931"]]),lt=k({__name:"BanListView",setup(e){return(o,a)=>{const g=ce;return I(),ie(g,{direction:"vertical",fill:""},{default:i(()=>[t(tt)]),_:1})}}});export{lt as default};
